<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scottish Fold Cat Jumper</title>
    <style>
        body{margin:0;padding:0;display:flex;justify-content:center;align-items:center;min-height:100vh;background:linear-gradient(#87CEEB,#98D8C8);font-family:Arial;overflow:hidden}
        canvas{border:2px solid #333;background:linear-gradient(#87CEEB 70%,#228B22);box-shadow:0 4px 20px rgba(0,0,0,.3);max-width:100%;max-height:100vh}
        .ui{position:absolute;top:20px;color:#333;font-weight:bold;text-shadow:1px 1px 2px #fff}
        .instructions{left:50%;transform:translateX(-50%);font-size:18px}
        .score{right:20px;font-size:24px}
        .highscore{left:20px;font-size:18px}
    </style>
</head>
<body>
    <div class="ui instructions">SPACE / UP / TAP to jump!</div>
    <div class="ui score">Score: <span id="score">0</span></div>
    <div class="ui highscore">Best: <span id="highscore">0</span></div>
    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score');
        const highscoreEl = document.getElementById('highscore');

        // High score
        let highScore = parseInt(localStorage.getItem('catJumperHighScore') || '0');
        highscoreEl.textContent = highScore;

        // Cat image
        const catImg = new Image();
        catImg.src = 'https://raw.githubusercontent.com/amerisaurusrex/amerisaurusrex.github.io/main/cat.png';

        // Game state
        const game = {
            cat: {x:150, y:400, w:90, h:80, vx:0, vy:0, onGround:false,
                  baseJump:-20.5, jump:-20.5, gravity:0.75, baseSpeed:2.8, speed:2.8},
            rooftops: [], camera:0, score:0, gameOver:false, keys:{}
        };

        let prevOnGround = false;
        let audioCtx = null;

        // Initialize audio
        function initAudio() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }

        // REALISTIC CAT MEOWS
        function meow(type = 'jump') {
            if (!audioCtx) return;
            const t = audioCtx.currentTime;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'triangle';
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            if (type === 'jump') {
                const vars = [
                    [880, 1350, 0.11, 0.24],
                    [720, 1100, 0.14, 0.22],
                    [950, 1300, 0.10, 0.26],
                    [800, 1200, 0.13, 0.23]
                ];
                const [s, e, d, v] = vars[Math.floor(Math.random() * vars.length)];
                osc.frequency.setValueAtTime(s, t);
                osc.frequency.exponentialRampToValueAtTime(e, t + d);
                gain.gain.setValueAtTime(v, t);
                gain.gain.exponentialRampToValueAtTime(0.01, t + d + 0.08);
                osc.start(t); osc.stop(t + d + 0.1);
            } else { // fall
                osc.frequency.setValueAtTime(1200, t);
                osc.frequency.exponentialRampToValueAtTime(600, t + 0.25);
                osc.frequency.exponentialRampToValueAtTime(250, t + 0.65);
                gain.gain.setValueAtTime(0.38, t);
                gain.gain.exponentialRampToValueAtTime(0.01, t + 0.85);
                osc.start(t); osc.stop(t + 0.9);
            }
        }

        // Generate rooftops
        function generateRooftops() {
            game.rooftops = [];
            let x = 200;
            for (let i = 0; i < 40; i++) {
                const progress = i / 40;
                const gap = 160 + progress * 140 + Math.random() * (60 + progress * 120);
                const heightVar = 90 + progress * 100;
                game.rooftops.push({
                    x: x,
                    y: 480 - (Math.random() - 0.5) * heightVar,
                    w: 130 + Math.random() * 90,
                    h: 30
                });
                x += gap;
            }
        }

        // Input
        window.addEventListener('keydown', e => { game.keys[e.code] = true; initAudio(); });
        window.addEventListener('keyup', e => game.keys[e.code] = false);
        canvas.addEventListener('touchstart', e => {
            e.preventDefault();
            initAudio();
            if (game.gameOver) resetGame();
            else if (game.cat.onGround) { game.cat.vy = game.cat.jump; game.cat.onGround = false; meow('jump'); }
        });

        // Draw functions
        function drawCat() {
            const x = game.cat.x - game.camera - 15;
            const y = game.cat.y - 10;
            ctx.save();
            ctx.shadowColor = '#fff';
            ctx.shadowBlur = 35;
            if (catImg.complete) {
                ctx.drawImage(catImg, x, y, game.cat.w + 30, game.cat.h + 30);
            } else {
                ctx.fillStyle = '#f8f8f8';
                ctx.beginPath(); ctx.ellipse(x + 40, y + 35, 35, 28, 0, 0, Math.PI*2); ctx.fill();
                ctx.beginPath(); ctx.ellipse(x + 40, y + 15, 28, 25, 0, 0, Math.PI*2); ctx.fill();
            }
            ctx.restore();
        }

        function drawRooftop(r) {
            const rx = r.x - game.camera;
            ctx.fillStyle = '#8B4513'; ctx.fillRect(rx, r.y, r.w, r.h);
            ctx.fillStyle = '#A0522D'; ctx.fillRect(rx, r.y - 5, r.w, 5);
        }

        // Main update
        function update() {
            if (game.gameOver) {
                if (game.keys['Space'] || game.keys['ArrowUp']) resetGame();
                return;
            }

            // Progressive difficulty
            const diff = game.score / 500;
            game.cat.speed = game.baseSpeed + diff * 1.2;
            game.cat.jump = game.baseJump - diff * 1.5;

            if ((game.keys['Space'] || game.keys['ArrowUp']) && game.cat.onGround) {
                game.cat.vy = game.cat.jump;
                game.cat.onGround = false;
                meow('jump');
            }

            game.cat.vy += game.cat.gravity;
            game.cat.y += game.cat.vy;
            game.cat.x += game.cat.speed;
            game.camera = Math.max(0, game.cat.x - 400);

            // Collision
            prevOnGround = game.cat.onGround;
            game.cat.onGround = false;
            for (const r of game.rooftops) {
                if (game.cat.x + game.cat.w > r.x && game.cat.x < r.x + r.w &&
                    game.cat.y + game.cat.h > r.y && game.cat.y + game.cat.h - game.cat.vy <= r.y + 5 && game.cat.vy > 0) {
                    game.cat.y = r.y - game.cat.h;
                    game.cat.vy = 0;
                    game.cat.onGround = true;
                    break;
                }
            }

            // Generate new rooftops
            const last = game.rooftops[game.rooftops.length - 1];
            if (last.x < game.camera + 1000) {
                const progress = game.score / 1000;
                const gap = 160 + progress * 140 + Math.random() * (100 + progress * 120);
                const heightVar = 90 + progress * 100;
                game.rooftops.push({
                    x: last.x + gap,
                    y: 480 - (Math.random() - 0.5) * heightVar,
                    w: 130 + Math.random() * 90,
                    h: 30
                });
            }

            game.rooftops = game.rooftops.filter(r => r.x > game.camera - 600);

            if (game.cat.y > 720) {
                meow('fall');
                game.gameOver = true;
                if (game.score > highScore) {
                    highScore = game.score;
                    localStorage.setItem('catJumperHighScore', highScore);
                    highscoreEl.textContent = highScore;
                }
            }

            game.score = Math.floor(game.camera / 10);
            scoreEl.textContent = game.score;
        }

        function render() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            game.rooftops.forEach(drawRooftop);
            drawCat();

            if (game.gameOver) {
                ctx.fillStyle = 'rgba(0,0,0,0.85)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#fff';
                ctx.font = '52px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('You Fell!', canvas.width/2, canvas.height/2 - 50);
                ctx.font = '28px Arial';
                ctx.fillText('Tap or press SPACE to try again', canvas.width/2, canvas.height/2 + 20);
                if (game.score > highScore) ctx.fillText('NEW HIGH SCORE: ' + game.score + '!', canvas.width/2, canvas.height/2 - 100);
            }
        }

        function resetGame() {
            generateRooftops();
            game.cat.x = 150;
            game.cat.y = game.rooftops[0].y - game.cat.h;
            game.cat.vy = 0;
            game.cat.onGround = true;
            game.cat.speed = game.baseSpeed;
            game.cat.jump = game.baseJump;
            game.camera = game.score = 0;
            game.gameOver = false;
        }

        function loop() {
            update();
            render();
            requestAnimationFrame(loop);
        }

        generateRooftops();
        resetGame();
        loop();
    </script>
</body>
</html>
